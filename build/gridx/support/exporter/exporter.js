//>>built
define("gridx/support/exporter/exporter",["dojo/_base/lang","dojo/_base/Deferred","dojo/_base/array"],function(p,l,n){function m(a,b,e,c){return!a[b]||!1!==a[b](e||c,c)}function w(a,b,e){var c=[],g=0,f=0,d=a.progressStep;"number"==typeof a.start&&0<=a.start&&(g=a.start);"number"==typeof a.count&&0<a.count&&(f=g+a.count);f=f||e;if(b)if(b=n.filter(b,function(a){return a>=g&&a<f}),b.length&&(!d||b.length<=d))c.push(b);else for(a=0;a<b.length;a+=d)c.push(b.slice(a,a+d));else if(b=f-g,!d||b<=d)c.push({start:g,
count:b});else for(a=g;a<f;a+=d)c.push({start:a,count:a+d<f?d:f-a});c.p=0;return c}function u(a,b,e){e=e.p+1;var c=p.isArray(a);return e<(c?a.length:a.start+a.count)?{p:e,row:b.row(c?a[e]:e)}:null}function r(a,b,e,c,g,f,d){var n=g.filter,s=c.columnIds,k=d[d.p++],h=p.hitch(f,f.errback),l=function(){b.progress(d.p/d.length);a.when(k,function(){for(var b=p.isArray(k)?{p:0,row:a.row(k[0])}:{p:k.start,row:a.row(k.start)};b&&b.row;b=u(k,a,b))if(c.row=b.row,(!n||n(b.row))&&m(e,"beforeRow",c,g)){for(var d=
0;d<s.length;++d){var f=a.column(s[d],1),h=c.cell=a.cell(b.row,f);c.column=f;var f=c,t;t=g;var l=t.formatters,r=h.column.id;t=l&&p.isFunction(l[r])?l[r](h):t.useStoreData?h.rawData()||"":h.data()||"";f.data=t;m(e,"handleCell",c,g)}m(e,"afterRow",c,g)}}).then(function(){r(a,b,e,c,g,f,d)},h)};k?1<d.length?setTimeout(l,10):l():f.callback()}function y(a,b){var e=a._columnsById,c;p.isArrayLike(b.columns)&&b.columns.length?(c=n.filter(b.columns,function(a){return e[a]}),c.sort(function(a,b){return e[a].index-
e[b].index})):c=n.map(a._columns,function(a){return a.id});return c}return function(a,b,e){var c=new l,g=a.model,f=y(a,e),d=a.select,v=d&&d.row,d=d&&d.column,s,k,h={grid:a,columnIds:f},u=function(){m(b,"afterBody",h,e);c.callback(b.getResult())},q=p.hitch(c,c.errback);try{if(m(b,"initialize",h,e),!e.omitHeader&&m(b,"beforeHeader",h,e)&&(n.forEach(f,function(c){h.column=a.column(c,1);m(b,"handleHeaderCell",h,e)}),m(b,"afterHeader",h,e)),m(b,"beforeBody",h,e)){if(e.selectedOnly&&v&&(!d||!d.getSelected().length))s=
g.when().then(function(){k=v.getSelected()},q);l.when(s,function(){var d,f=k&&g.when({id:k},function(){d=n.map(k,function(a){return g.idToIndex(a)});d.sort(function(a,b){return a-b})},q);l.when(f,function(){var f=new l,k=g.size();r(a,c,b,h,e,f,w(e,d,k));f.then(u,q)},q)},q)}else c.callback(b.getResult())}catch(x){q(x)}return c}});
//@ sourceMappingURL=exporter.js.map