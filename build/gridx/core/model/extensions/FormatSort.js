//>>built
define("gridx/core/model/extensions/FormatSort",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/data/util/sorter","../_Extension"],function(p,q,n,l,r){function s(a,d,g,c){return function(e,h){return c.getValue?d*g(c.getValue(e,a),c.getValue(h,a)):d*g(e[a],h[a])}}function t(a,d,g,c,e,h){var b={};return function(a,k){var f=c.getIdentity(a),m=c.getIdentity(k);b[f]||(b[f]=h(e._itemToObject(a)));b[m]||(b[m]=h(e._itemToObject(k)));return d*g(b[f],b[m])}}return p(r,{name:"formatSort",priority:50,
constructor:function(a){a=this.cache=a._cache;this.aspect(a,"onBeforeFetch","_onBeforeFetch");this.aspect(a,"onAfterFetch","_onAfterFetch")},_onBeforeFetch:function(a){var d=this.model.store;this._oldCreateSortFunction=l.createSortFunction;l.createSortFunction=n.hitch(this,this._createComparator);a.sort&&n.isFunction(d.put)&&(a.sort=this._createComparator(a.sort,d))},_onAfterFetch:function(){this._oldCreateSortFunction&&(l.createSortFunction=this._oldCreateSortFunction,delete this._oldCreateSortFunction)},
_createComparator:function(a,d){var g=[],c=this.cache,e=d.comparatorMap,h=l.basicComparator;q.forEach(a,function(b){var a=b.attribute,k=b.descending?-1:1,f=h;b=c.columns&&c.columns[b.colId];e&&("string"!==typeof a&&a.toString&&(a=a.toString()),f=e[a]||h);b&&b.comparator&&(f=b.comparator);b=b&&b.sortFormatted&&b.formatter;g.push(b?t(a,k,f,d,c,b):s(a,k,f,d))});return function(a,d){var c,f,e=0;c=0;for(f=g.length;!e&&c<f;++c)e=g[c](a,d);return e}}})});
//@ sourceMappingURL=FormatSort.js.map