//>>built
define("gridx/modules/extendedSelect/Cell","dojo/_base/declare dojo/_base/array dojo/_base/event dojo/query dojo/_base/lang dojo/_base/Deferred dojo/_base/sniff dojo/dom-class dojo/mouse dojo/keys ../../core/_Module ./_RowCellBase".split(" "),function(x,l,y,r,v,z,w,n,A,B,D,C){var t=v.isArrayLike;return x(C,{name:"selectCell",cellMixin:{select:function(){this.grid.select.cell.selectByIndex(this.row.index(),this.column.index());return this},deselect:function(){this.grid.select.cell.deselectByIndex(this.row.index(),
this.column.index());return this},isSelected:function(){return this.grid.select.cell.isSelected(this.row.id,this.column.id)}},getSelected:function(){var a=this,c=[];l.forEach(a.grid._columns,function(b){var d=a.model.getMarkedIds(a._getMarkType(b.id));c.push.apply(c,l.map(d,function(a){return[a,b.id]}))});return c},clear:function(a){var c=this;r(".gridxCellSelected",c.grid.bodyNode).forEach(function(a){n.remove(a,"gridxCellSelected");a.removeAttribute("aria-selected")});l.forEach(c.grid._columns,
function(a){c.model.clearMark(c._getMarkType(a.id))});c._clear();a||c._onSelectionChange()},isSelected:function(a,c){return this.model.getMark(a,this._getMarkType(c))},_type:"cell",_markTypePrefix:"select_",_getMarkType:function(a){a=this._markTypePrefix+a;this.model._spTypes[a]=1;return a},_markById:function(a,c){t(a[0])||(a=[a]);var b=this,d=b.grid._columnsById,f=b.model;l.forEach(a,function(a){var p=a[0];a=a[1];p&&d[a]&&f.markById(p,c,b._getMarkType(a))});f.when()},_markByIndex:function(a,c){t(a[0])||
(a=[a]);a=l.filter(a,function(a){if(t(a)&&2<=a.length&&0<=a[0]&&Infinity>a[0]&&0<=a[1]&&Infinity>a[1])return 4<=a.length&&(0<=a[2]&&Infinity>a[2]&&0<=a[3]&&Infinity>a[3])&&(a._range=1),!0});var b=this,d=b.model,f=b.grid,s=f._columns,p=f.view,g,h,k,m,e;l.forEach(a,function(a){if(a._range){var f=Math.min(a[0],a[2]),l=Math.max(a[0],a[2])-f+1,u=Math.min(a[1],a[3]);a=Math.max(a[1],a[3]);for(g=u;g<=a;++g)if(k=s[g]){e=p.getRowInfo({visualIndex:f});f=e.rowIndex;m=b._getMarkType(k.id);for(h=0;h<l;++h)d.markByIndex(f+
h,c,m,e.parentId)}}else if(k=s[a[1]])e=p.getRowInfo({visualIndex:a[0]}),g=e.rowIndex,d.markByIndex(g,c,b._getMarkType(k.id),e.parentId)});return d.when()},_init:function(){var a=this,c=a.grid;a.inherited(arguments);a.batchConnect([c,"onCellMouseDown",function(b){if(A.isLeft(b)&&(!c.select.row||!c.select.row.arg("triggerOnCell"))&&!n.contains(b.target,"gridxTreeExpandoIcon")&&!n.contains(b.target,"gridxTreeExpandoInner"))a._start({rid:b.rowId,r:b.visualIndex,cid:b.columnId,c:b.columnIndex},c._isCtrlKey(b),
b.shiftKey),!b.shiftKey&&!a.arg("canSwept")&&a._end()}],[c,"onCellMouseOver",function(b){a._highlight({rid:b.rowId,r:b.visualIndex,cid:b.columnId,c:b.columnIndex})}],[c,4>w("ff")?"onCellKeyUp":"onCellKeyDown",function(b){if(b.keyCode===B.SPACE&&(!c.focus||"body"==c.focus.currentArea()))y.stop(b),a._start({rid:b.rowId,r:b.visualIndex,cid:b.columnId,c:b.columnIndex},c._isCtrlKey(b),b.shiftKey),a._end()}])},_onRender:function(a,c){var b,d,f=this.model,s=this.grid,p=s._columns,g=a+c;for(b=0;b<p.length;++b){var h=
p[b].id,k=this._getMarkType(h);if(f.getMarkedIds(k).length)for(d=a;d<g;++d){var m=this._getRowId(d);(f.getMark(m,k)||this._selecting&&this._toSelect&&this._inRange(b,this._startItem.c,this._currentItem.c,1)&&this._inRange(d,this._startItem.r,this._currentItem.r,1))&&n.add(r('[visualindex\x3d"'+d+'"] [colid\x3d"'+s._escapeId(h)+'"]',s.bodyNode)[0],"gridxCellSelected")}}},_onMark:function(a,c,b,d){if(v.isString(d)&&(!this._marking&&0===d.indexOf(this._markTypePrefix))&&(b=this.grid._escapeId,a=r('[rowid\x3d"'+
b(a)+'"]',this.grid.bodyNode)[0]))d=d.substr(this._markTypePrefix.length),(d=r('[colid\x3d"'+b(d)+'"]',a)[0])&&n.toggle(d,"gridxCellSelected",c)},_onMoveToCell:function(a,c,b){if(b.shiftKey){var d=this.grid,f=this._getRowId(a);this._start({rid:f,r:a,cid:d._columns[c].id,c:c},d._isCtrlKey(b),1);this._end()}},_isSelected:function(a){a.rid||(a.rid=this._getRowId(a.r));if(this._isRange){var c=this._refSelectedIds[a.cid];return c&&0<=l.indexOf(c,a.rid)}return this.model.getMark(a.rid,this._getMarkType(a.cid))},
_highlight:function(a){var c=this,b=c._currentItem;if(c._selecting){if(null===b)c._highlightSingle(a,1),w("ie")&&c._focus(a);else{var d=c._startItem,f=function(a,b,d){var f=b.c>a.c?1:-1,k=b.r>a.r?1:-1,m,e,q,l,n={};if(!d){e=a.r;for(q=b.r+k;e!=q;e+=k)n[e]=c.model.indexToId(e)}m=a.c;for(l=b.c+f;m!=l;m+=f){var u=c.grid._columns[m].id;e=a.r;for(q=b.r+k;e!=q;e+=k)c._highlightSingle({rid:n[e],r:e,cid:u,c:m},d)}};(c._inRange(a.r,d.r,b.r)||c._inRange(a.c,d.c,b.c)||c._inRange(d.r,a.r,b.r)||c._inRange(d.c,a.c,
b.c))&&f(d,b,0);f(d,a,1);c._focus(a)}c._currentItem=a}},_doHighlight:function(a,c){var b,d=this.grid.bodyNode.childNodes;for(b=d.length-1;0<=b;--b)if(d[b].getAttribute("visualindex")==a.r){d=d[b].getElementsByTagName("td");for(b=d.length-1;0<=b;--b)if(d[b].getAttribute("colid")==a.cid){n.toggle(d[b],"gridxCellSelected",c);d[b].setAttribute("aria-selected",!!c);break}break}},_focus:function(a){this.grid.focus&&this.grid.body._focusCell(null,a.r,a.c)},_getSelectedIds:function(){var a=this,c={};l.forEach(a.grid._columns,
function(b){var d=a.model.getMarkedIds(a._getMarkType(b.id));d.length&&(c[b.id]=d)});return c},_beginAutoScroll:function(){},_endAutoScroll:function(){},_addToSelected:function(a,c,b){var d=this,f=d.model,l=d.grid.view,p=new z,g=d._lastEndItem,h,k,m,e,q=[],n=function(){f.when().then(function(){p.callback()})};d._isRange||(d._refSelectedIds=d._getSelectedIds());d._isRange&&(d._inRange(c.r,a.r,g.r)&&(h=Math.min(c.r,g.r),k=Math.max(c.r,g.r),e=l.getRowInfo({visualIndex:h+1}),q.push({start:e.rowIndex,
count:k-h,columnStart:a.c,columnEnd:g.c})),d._inRange(c.c,a.c,g.c)&&(m=c.c<g.c?1:-1,h=Math.min(a.r,c.r),k=Math.max(a.r,c.r),e=l.getRowInfo({visualIndex:h}),q.push({start:e.rowIndex,count:k-h+1,columnStart:c.c+m,columnEnd:g.c})));m=a.c<c.c?1:-1;for(g=a.c;g!=c.c+m;g+=m){var r=d._getMarkType(d.grid._columns[g].id);h=Math.min(a.r,c.r);for(k=Math.max(a.r,c.r);h<=k;++h)e=l.getRowInfo({visualIndex:h}),f.markByIndex(e.rowIndex,b,r,e.parentId)}q.length?f.when(q,function(){var a,b,c,e;for(a=0;a<q.length;++a){e=
q[a];var g=e.columnStart<e.columnEnd?1:-1;for(b=e.columnStart;b!=e.columnEnd+g;b+=g){c=d.grid._columns[b].id;var k=d._getMarkType(c),h=d._refSelectedIds[c];for(c=e.start;c<e.start+e.count;++c){var l=f.indexToId(c);f.markById(l,h&&h[l],k)}}}}).then(n):n();return p}})});
//@ sourceMappingURL=Cell.js.map