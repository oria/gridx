//>>built
define("gridx/modules/VScroller","dojo/_base/declare dojo/_base/Deferred dojo/_base/event dojo/_base/sniff dojo/query dojo/dom-geometry dojo/dom-class dojo/dom-style dojo/keys dojox/html/metrics ../core/_Module".split(" "),function(u,p,s,k,v,m,w,x,n,t,y){return u(y,{name:"vScroller",forced:["view","body","vLayout","columnWidth"],optional:["pagination"],constructor:function(){var b=this.grid,d=this.domNode=b.vScrollerNode;this.stubNode=d.firstChild;if(b.autoHeight)d.style.display="none",8>k("ie")&&
(d.style.width="0px");else if(k("mac"))w.add(b.domNode,"gridxMac");else{var a=t.getScrollbar().w,b=b.isLeftToRight();d.style.width=a+"px";d.style[b?"right":"left"]=-a+"px";8>k("ie")&&(this.stubNode.style.width=a+1+"px")}},preload:function(b){this.grid.hLayout.register(null,this.domNode,1)},load:function(b,d){var a=this,e=a.grid,f=e.body,c=a.domNode,g=e.bodyNode;a.batchConnect([a.domNode,"onscroll","_doScroll"],[g,"onmousewheel","_onMouseWheel"],[e.mainNode,"onkeypress","_onKeyScroll"],k("ff")&&[g,
"DOMMouseScroll","_onMouseWheel"]);a.aspect(e,"_onResizeEnd","_onBodyChange");a.aspect(f,"onForcedScroll","_onForcedScroll");a.aspect(f,"onRender","_onBodyChange");a.aspect(e.header,"onRender","_onBodyChange");e.autoHeight||a.aspect(f,"onEmpty",function(){var b=c.style;b.display="none";b.width="";8>k("ie")&&(b.width=a.stubNode.style.width="0px");e.hLayout.reLayout();e.hScroller.refresh()});d.then(function(){a._updatePos();p.when(a._init(b),function(){a.domNode.style.width="";a.loaded.callback()})})},
scrollToRow:function(b,d){var a=new p,e=this.grid.bodyNode,f=this.domNode,c=0,g=v('[visualindex\x3d"'+b+'"]',e)[0],l=function(b){setTimeout(function(){a.callback(b)},5)};if(g){var c=g.offsetTop,q=e.scrollTop;if(d)return f.scrollTop=c,l(!0),a;if(c<=q)c-=q;else if(c+g.offsetHeight>q+e.clientHeight)c=c+g.offsetHeight-q-e.clientHeight;else return l(!0),a;f.scrollTop+=c}l(!!g);return a},scroll:function(b){this.domNode.scrollTop=b},position:function(){return this.domNode.scrollTop},_init:function(){return this._onForcedScroll()},
_update:function(){var b=this.grid;if(!b.autoHeight){var d=b.body,a=b.bodyNode,a=a.scrollHeight>a.clientHeight||a.scrollHeight==a.clientHeight&&d.renderCount<b.view.visualCount,d=this.domNode.style;scrollBarWidth=t.getScrollbar().w+(k("webkit")?1:0);if(8>k("ie")){var e=a?scrollBarWidth+2+"px":"0px";this.stubNode.style.width=e;d.width=e}else d.width="";a=a?"block":"none";e=a!=(x.get(this.domNode,"display")||"block");d.display=a;(this._updatePos()||e)&&b.hLayout.reLayout()}},_updatePos:function(){var b=
this.grid,d=this.domNode,a=d.style,e=b.isLeftToRight(),b=m.getBorderExtents(b.mainNode),f=e?"right":"left";oldValue=a[f];a[f]=-(d.offsetWidth+(e?b.r:b.l))+"px";return oldValue!=a[f]},_doScroll:function(){this.grid.bodyNode.scrollTop=this.domNode.scrollTop},_onMouseWheel:function(b){"none"!=this.grid.vScrollerNode.style.display&&(this.domNode.scrollTop-="number"===typeof b.wheelDelta?b.wheelDelta/3:-40*b.detail,s.stop(b))},_onBodyChange:function(){var b=this,d=b.grid;b._update();setTimeout(function(){d.bodyNode&&
(b.stubNode.style.height=d.bodyNode.scrollHeight+"px",b._doScroll(),d.vScrollerNode.scrollTop=d.vScrollerNode.scrollTop||0)},0)},_onForcedScroll:function(){var b=this.grid.view,d=this.grid.body;return this.model.when({start:b.rootStart,count:b.rootCount},function(){d.renderRows(0,b.visualCount)})},_onKeyScroll:function(b){var d=this.grid,a=d.body,e=d.bodyNode,f=d.focus,c=this.domNode,g=d._isCtrlKey(b),l;if(e.childNodes.length&&(!f||"body"==f.currentArea())){if(b.keyCode==n.HOME&&g)c.scrollTop=0,l=
e.firstChild,a._focusCellCol=0;else if(b.keyCode==n.END&&g)c.scrollTop=c.scrollHeight-c.offsetHeight,l=e.lastChild,a._focusCellCol=d._columns.length-1;else if(b.keyCode==n.PAGE_UP)c.scrollTop?c.scrollTop-=c.offsetHeight:l=e.firstChild;else if(b.keyCode==n.PAGE_DOWN)c.scrollTop>=c.scrollHeight-c.offsetHeight?l=e.lastChild:c.scrollTop+=c.offsetHeight;else return;f&&(l?(a._focusCellRow=parseInt(l.getAttribute("visualindex"),10),f.focusArea("body",1)):setTimeout(function(){for(var d=e.childNodes,c=0,
g=d.length-1,h=m.position(e),k,r,p=function(a){var c=d[a];a=m.position(c);if(b.keyCode==n.PAGE_DOWN)return c=c.previousSibling,!c&&a.y>=h.y||a.y==h.y?0:c?(a=m.position(c),a.y<h.y&&a.y+a.h>=h.y?0:a.y>h.y?1:-1):-1;c=c.nextSibling;return!c&&a.y+a.h<=h.y+h.h||a.y+a.h==h.y+h.h?0:c?(a=m.position(c),a.y<=h.y+h.h&&a.y+a.h>h.y+h.h?0:a.y>h.y+h.h?1:-1):1};c<=g;)if(k=Math.floor((c+g)/2),r=p(k),0>r)c=k+1;else if(0<r)g=k-1;else{l=d[k];break}l&&(a._focusCellRow=parseInt(l.getAttribute("visualindex"),10),f.focusArea("body",
1))},0));s.stop(b)}}})});
//@ sourceMappingURL=VScroller.js.map