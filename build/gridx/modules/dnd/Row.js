//>>built
define("gridx/modules/dnd/Row","dojo/_base/declare dojo/_base/array dojo/_base/Deferred dojo/_base/lang dojo/dom-class dojo/dom-geometry dojo/_base/sniff ./_Base ../../core/_Module".split(" "),function(w,q,m,u,x,n,y,z,B){function A(b,f){if(b.grid){var a=new m,c=r(a,a.callback),d=r(a,a.errback),g=[],h=b.grid,k=h.dnd.row._selectedRowIds;h.model.when({id:k},function(){s(k,function(a){h.model.idToIndex(a);(a=h.model.byId(a))&&g.push(u.clone(a.rawData))})}).then(function(){c(g)},d);return a}return b.getGridDndRowData&&
b.getGridDndRowData(f)||[]}var r=u.hitch,s=q.forEach;return w(z,{name:"dndRow",required:["_dnd","moveRow"],getAPIPath:function(){return{dnd:{row:this}}},accept:["grid/rows"],provide:["grid/rows"],onDraggedOut:function(b){var f=[];if(b.grid)f=b.grid.dnd._dnd.profile.arg("accept");else for(var a in b.accept)f.push(a);if(!this.checkArg("copyWhenDragOut",f)){b=this.grid;var c=b.model,d=b.store,g=this._selectedRowIds;if(d.fetch){var h=[];b.model.when({id:g},function(){s(g,function(a){(a=c.byId(a))&&h.push(a.item)})}).then(function(){s(h,
d.deleteItem,d);d.save()})}else s(g,d.remove,d)}},_checkDndReady:function(b){var f=this.model;return!f.getMark||f.getMark(b.rowId)?(this.grid.dnd._dnd.profile=this,this._selectedRowIds=f.getMarkedIds?f.getMarkedIds():[b.rowId],!0):!1},_cssName:"Row",_onBeginDnd:function(b){b.delay=this.arg("delay")},_getDndCount:function(){return this._selectedRowIds.length},_onEndDnd:function(){},_buildDndNodes:function(){var b=this.grid.id;return q.map(this._selectedRowIds,function(f){return["\x3cdiv id\x3d'",b,
"_dndrow_",f,"' gridid\x3d'",b,"' rowid\x3d'",f,"'\x3e\x3c/div\x3e"].join("")}).join("")},_onBeginAutoScroll:function(){this.grid.autoScroll.horizontal=!1},_onEndAutoScroll:function(){this.grid.autoScroll.horizontal=!0},_getItemData:function(b){return b.substring((this.grid.id+"_dndrow_").length)},_calcTargetAnchorPos:function(b,f){var a=this,c=b.target,d=a.grid.view,g={width:f.w+"px",height:"",left:""},h=function(b){return a.model.getMark&&a.model.getMark(b.getAttribute("rowid"))},k=function(a){return parseInt(a.getAttribute("visualindex"),
10)},p=function(c){var d=c,e=d,l=d;if(h(d)){for(e=d.previousSibling;e&&h(e);)d=e,e=e.previousSibling;e=d;d=c;for(l=d.nextSibling;l&&h(l);)d=l,l=l.nextSibling;l=d}e&&l?(d=n.position(e),c=n.position(l),b.clientY<(d.y+c.y+c.h)/2?(a._target=k(e),g.top=d.y-f.y+"px"):(a._target=k(l)+1,g.top=c.y+c.h-f.y+"px")):delete a._target;return g};if(!y("ff"))for(;c;){if(x.contains(c,"gridxRow"))return p(c);c=c.parentNode}var t=a.grid.bodyNode,v=t.childNodes;if(v.length){var c=t.firstChild,m=k(c),e=n.position(c);if(0===
m&&b.clientY<=e.y+e.h)g.top=e.y-f.y+"px",a._target=0;else if(c=t.lastChild,m=k(c),e=n.position(c),m===d.visualCount-1&&b.clientY>e.y+e.h)g.top=e.y+e.h-f.y+"px",a._target=d.visualCount;else return q.some(v,function(a){e=n.position(a);if(e.y<=b.clientY&&e.y+e.h>=b.clientY)return c=a,!0})?p(c):null}else g.top="0px",a._target=0;return g},_onDropInternal:function(b,f){var a=this,c=a.grid;0<=a._target&&a.model.when({id:a._selectedRowIds},function(){var b=q.map(a._selectedRowIds,function(b){return a.model.idToIndex(b)});
c.move.row.move(b,c.view.getRowInfo({visualIndex:a._target}).rowIndex)})},_onDropExternal:function(b,f,a){a=new m;var c=r(a,a.callback),d=r(a,a.errback),g=this.grid,h=this._target,k,p,n=A(b,f);g.model.when([h-1,h],function(){k=g.model.byIndex(h);p=g.model.byIndex(h-1)}).then(function(){m.when(n,function(a){a&&a.length&&(a=g.model.insert(a,p&&p.item,k&&k.item),m.when(a,c,d))},d)},d);return a}})});
//@ sourceMappingURL=Row.js.map